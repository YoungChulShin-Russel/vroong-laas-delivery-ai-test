# 배송 시스템 구축
## 배경
- 음식 배송 서비스를 MSA로 개발 중. 
- 현재 3개의 MSA가 있고, 역할은 아래와 같다. 
   1. order: 주문 서버
      - 고객이 요청하는 배송 요청을 받아서 order를 생성하고, '주문 생성' 이벤트를 발행한다. 
   2. dispatch: 배차 서버
      - 주문서버의 '주문 생성' 이벤트를 받아서, 기사에게 배차를 시도한다. 
      - 배차 되면 '배차 완료' 이벤트를 발행한다. 
   3. delivery: 배송 서버
      - '배차 완료' 이벤트를 받아서, 배송을 수행한다. 
- 이 프로젝트는 '배송 서버'를 구현한다. 

## 도메인 정책
- 일반 배송은 4개의 단계로 수행된다. 
   1. 배송 시작
   2. 상점 도착
   3. 픽업
   4. 배송 완료
      - 비대면 배송은 배송 사진을 업로드해야한다. 
- 배송이 생성될 때 기사의 안심번호를 생성해야한다. 
   - 기사의 연락처는 기사 서버를 호출해서 가져올 수 있다. 
- 기사는 음식을 픽업을 하기 전까지는 배송을 취소할 수 있다. 
- 배송은 취소될 수 있다. 
- 오더의 배송 상태 변경 이력을 조회할 수 있어야한다. 

## 시스템 요구 사항
- '오더' 서버를 호출해서 오더의 배송 정책을 알 수 있다.  
   ```java
    boolean alcoholDelivery, // 주류 배송 여부
    boolean contactlessDelivery,  // 비대면 배소 ㅇ여부
    boolean reservedDelivery,   // 예약 배송 여부 -> 배송 서버 관심 아님
    Instant reservedDeliveryStartTime,   // 예약 배송 시작 시간 -> 배송 서버 관심 아님
    Instant pickupRequestTime)  // 상점 음식 픽업 요청 시간
   ```

- 기사 배정 이벤트는 아래 정보를 포함한다. 
   - 배차 아이디 (dispatch_id)
   - 기사 아이디 (agent_id)
   - 오더 아이디 (order_id)
   - 배송비 (delivery_fee)
   - 배차 시간 (dispatched_at)